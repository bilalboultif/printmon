<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title> Bilal ASIN & LPN</title>
<link rel="stylesheet" href="./index.css">
  </head>
  <body>
    <noscript>
    <h1 style="text-align:center; font-family: Arial; color: red;">Enable Javascript or Allow Content</h1>
    </noscript>
    <!--show the navigation menu-->
      <div id="tool_area" class="printmon_tools">
      
        <span id="nav_barcodegen" class="toolselected">
            Bilal Barcode Generator
        </span>
        
          
      
      </div>
    
    
    <div class="title">
    <div class="titletext"><a href=""><img src=""></img></a><div></div>
    <div class "titletext>
    
    <br>
    <form id="form" name="form" action="formprocessor.html" method="GET">
    <div style="font-size: small; text-align: left;  padding-left: 50px;">
    <input id="printafter" type="checkbox" checked=" ">  Print after scanning<br>
    <input id="jumptoq" type="checkbox" >  Jump to quantity<br>
    <input id="nowhitespace" type="checkbox" checked=" ">  Trim whitespace characters<br>
    </div>
    <br>
    
    
    <p>Scan or Enter Barcode Data <br><i style="font-size: small">Limited to 43 Characters</i><br>
    <input maxlength="43" id="barcodedata" type="text" />
    </p>
    <p>Enter Display Text <br>
    <input maxlength="43" id="displaytext" type="text" />
    </p>
    <p>Enter Quantity<br>
    <i style="font-size: small">Maximum is 500</i><br>
    <input maxlength="3" id="quantity" type="text" value="1" /><br>
    
    </p>
    
    <p><a class="apmbutton" style="margin-top: 5px;" href="#" onclick="printlabel();"> Print Label</a></p>
    </div>
    
    
    <input id="bilal" type="button" onclick="myFunction()" value="Reset form">
    </form>
    <script>
    var webuiport = 5965;

function genId()
{
	var id = "";

	for(var i=0; i < 10; i++ )
		id += Math.floor(Math.random() * 9);

	return id;
}


function getStatus(url, funcvalid, funcinvalid)
{
	var xmlhttp;

	if (window.XMLHttpRequest)
		xmlhttp=new XMLHttpRequest();
 
	xmlhttp.onreadystatechange=function()
	{
		if (xmlhttp.readyState==4)
		{
			if (xmlhttp.responseText == "valid")
				funcvalid();
			else	
				funcinvalid();
		}
	};

	try
	{  
		xmlhttp.open("GET",url,true);
		xmlhttp.send();
	}
	catch(e)
	{
		funcinvalid();
	}	
}

function asciihex(str)
 {
  var text = "";
  
  for (var i = 0, l = str.length; i < l; i ++)
  {
	var hex = Number(str.charCodeAt(i)).toString(16);
	text += hex;
  }
 
 return text;
}

function printFailed()
{
	alert("failed to print the barcode!");
}

function printlabel()
{
	var barcode  =  document.getElementById("barcodedata").value;
	var text =	document.getElementById("displaytext").value;
	

	if (document.getElementById("nowhitespace").checked)
	{
		barcode = barcode.trim();
		text = text.trim();
	}

	getStatus("http://localhost:" + webuiport + "/printer?action=print&type=barcode&" + "data=" + asciihex(barcode) + "&text=" + asciihex(text) + "&quantity=" + document.getElementById("quantity").value + "&seq=" + genId(), function(){}, printFailed);
	document.getElementById('barcodedata').select(); 
}

function focusElement(id)
{
   document.getElementById(id).value = "";
   document.getElementById(id).focus();
}


function KeyCheck(e)
{
  //listen for scanner prefix [CR]
  if(e.keyCode == 13)
  {
    if(document.activeElement == document.getElementById('barcodedata') && document.getElementById("jumptoq").checked )
    {
      setTimeout (function(){focusElement("quantity"); }, 10);
    }
    else if(document.activeElement == document.getElementById('barcodedata'))
	{
		if (document.getElementById("printafter").checked) printlabel();
		else document.getElementById('barcodedata').select();
	}
	else if (document.activeElement == document.getElementById('quantity') && document.getElementById("jumptoq").checked && document.getElementById("printafter").checked)
    {
	 printlabel();
      setTimeout (function(){focusElement("barcodedata");}, 10);
    }
  }
}

  
    

    window.addEventListener('keydown', KeyCheck, false);
    
    function myFunction() {
        document.getElementById("form").reset();
      }
    </script>
    <script src="./index.js"></script>
</body></html>
